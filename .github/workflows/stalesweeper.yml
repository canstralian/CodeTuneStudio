name: Stale Issue and Discussion Sweeper

# Run daily at 1:00 AM UTC to clean up stale items
on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:  # Allow manual trigger

permissions:
  issues: write
  discussions: write

jobs:
  stale-sweep:
    runs-on: ubuntu-latest
    name: Clean up stale issues and discussions
    
    steps:
      - name: Run StaleSweeper for discussions
        uses: steffen-karlsson/stalesweeper@v1.1.1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          # Close discussions after 60 days of inactivity
          days-before-close: 60
          # Also close unanswered discussions
          close-unanswered: true
          # Default reason for closing
          close-reason: outdated
          # Enable verbose logging
          verbose: true
          # Message to post when closing
          message: |
            This discussion has been automatically closed due to inactivity for 60 days.
            If you believe this discussion should remain open, please reopen it and provide additional context.
      
      - name: Close stale issues
        uses: actions/stale@v10
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          # Mark issues stale after 60 days
          days-before-stale: 60
          # Close stale issues after 7 additional days
          days-before-close: 7
          # Labels
          stale-issue-label: 'stale'
          exempt-issue-labels: 'pinned,security,bug'
          # Messages
          stale-issue-message: |
            This issue has been automatically marked as stale due to inactivity for 60 days.
            It will be closed in 7 days if no further activity occurs.
            If this issue is still relevant, please add a comment to keep it open.
          close-issue-message: |
            This issue has been automatically closed due to prolonged inactivity.
            If you believe this issue should be reopened, please create a new issue and reference this one.
          # Don't mark PRs as stale (handle separately if needed)
          days-before-pr-stale: -1
          days-before-pr-close: -1
